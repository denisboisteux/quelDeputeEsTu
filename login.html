<!DOCTYPE html>
<html ng-app="nideputenisoumises">

  <head>
    <meta charset="utf-8" />
    <title>AngularJS Plunker</title>
    <link data-require="bootstrap-css@3.3.6" data-semver="3.3.6" rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.css" />
    <script>document.write('<base href="' + document.location + '" />');</script>
    <link rel="stylesheet" href="modern-business.css" />
    <script data-require="angular.js@1.0.x" src="https://code.angularjs.org/1.0.8/angular.js" data-semver="1.0.8"></script>
    <script data-require="jquery@2.2.0" data-semver="2.2.0" src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>
    <script data-require="bootstrap@3.3.6" data-semver="3.3.6" src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
    <script src="app.js"></script>  
    
    <script type="text/javascript">
			varaccess_token = "";
			
			function signinCallback(authResult) {
				//Votre fonction de rappel est une fonction JavaScript que vous avez écrite et qui est déclenchée lorsque l'utilisateur autorise ou refuse l'accès aux informations requises par votre application.
				//Un objet représentant le résultat de l'autorisation est transmis à la fonction.
				//Si l'utilisateur a accepté précédemment d'accorder un accès à votre application via ce bouton ou un autre bouton représentant la même application, il est automatiquement connecté.
				//La fonction de rappel est appelée automatiquement dès que la page se charge et reçoit un nouvel objet d'autorisation avec un jeton d'accès.
	
				console.log('Fonction signinCallback');
				if (authResult['access_token']) {
					console.log('access_token accessible');
					// Autorisation réussie
					// Masquer le bouton de connexion maintenant que l'utilisateur est autorisé et montre celui pour se déconnecter
					document.getElementById('signinButton').setAttribute('style', 'display: none');
					document.getElementById('signinOut').setAttribute('style', 'display: inline');
					
					varaccess_token = authResult['access_token']
					console.log('Token : ' + varaccess_token);
					var divToken = document.getElementById('varToken'); //On stocke le token dans une Div. Cela permettra par la suite de se déconnecter avec ce même token
					//divToken.innerHTML = varaccess_token;					
					
					//getInfos(); // Déclencher une requête pour obtenir l'adresse e-mail.
				} else if (authResult['error']) {
					console.log(console.log('Une erreur s est produite lors de la récupération du token dans la fonction signinCallback : ' + authResult['error']));
				}				
			}
			function getInfos(){
				// Charger les bibliothèques OAuth2 pour activer les méthodes userinfo.
				gapi.client.load('oauth2', 'v2', function() {
					var request = gapi.client.oauth2.userinfo.get();
					request.execute(getInfosCallback);
				});
			}
			function getInfosCallback(obj){
				var divName = document.getElementById('DivName');
				var divIdGoogle = document.getElementById('DivIdGoogle');
				var divEmail = document.getElementById('DivIEmail');
				var divGivenName = document.getElementById('DivGivenName');
				var divPicture = document.getElementById('DivPicture');
				if (obj['name']) {divName.innerHTML = 'Name : ' + obj['name'];}
				if (obj['id']) {divIdGoogle.innerHTML = 'Id : ' + obj['id'];}
				if (obj['email']) {divEmail.innerHTML = 'Email : ' + obj['email'];}
				if (obj['given_name']) {divGivenName.innerHTML = 'given_name : ' + obj['given_name'];}
				if (obj['picture']) {divPicture.innerHTML = 'picture : ' + obj['picture'];}
				//console.log(obj);   // Retirer les commentaires pour inspecter l'objet complet dans la console et voir ainsi ses propriétés
			}
			
			
			
			// Déclenchement possible de la dissociation lorsque l'utilisateur clique sur un bouton
			//$('#revokeButton').click(disconnectUser);
	
		</script>
		
  </head>

  <body ng-controller="MainCtrl">
    
    <div class="navTemplate"></div>
    
    <div class="container">

        <div class="row">
            <div class="col-lg-12">
                <h1 class="page-header">
                    Authentification requise
                </h1>
            </div>
        </div>

        <div class="row">
          <div class="col-xs-6 col-xs-offset-3">
            <div class="panel panel-primary">
              <div class="panel-heading">Connexion</div>
              <div class="panel-body">
                Identifie toi avec un compte Google.
                <br/>
                <div id="signinButton" style="display: inline;">
          				<!-- Ci dessous au niveau de data-clientid il vous faudra mettre vo id de dev google-->
          				<div class="g-signin" data-callback="signinCallback"
          				data-requestvisibleactions="http://schemas.google.com/AddActivity"
          				data-clientid="149865370621-ep07k9i24edon0krf12m34tmvc1naekn.apps.googleusercontent.com"
          				data-scope="https://www.googleapis.com/auth/plus.login"
          				data-cookiepolicy="single_host_origin"
          				>
          				</div>
          			</div>
          			<div id="DivName"></div>
          			<div id="DivIdGoogle"></div>
          			<div id="DivGivenName"></div>
          			<div id="DivPicture"></div>		
          			<div id="DivIEmail" ></div>
          			<div id="varToken"></div>
          
          			<div id="signinOut"  style="display: none;">
          				<input type="button"  value="Deco Google" name="ButtEnvFichier" ng-click=fctDeco()>
          			</div>
              </div>
            </div>
          </div>
        </div>
        

        <br/>
        <hr>
        <footer class="footerTemplate"></footer>

    </div>
  </body>

</html>        
